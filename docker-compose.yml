services:
  seplan:
    build:
      dockerfile: ./Dockerfile
      # ulimits:
      #   nofile:
      #     soft: 65536
      #     hard: 65536
    # image: "${DOCKER_REGISTRY_HOST:-localhost}/openforis/seplan:${SEPAL_VERSION:-latest}"
    image: "openforis/seplan"
    container_name: seplan
    # init: true
    volumes:
      # - "${SEPAL_DATA_DIR}/sepal/home:/sepalUsers"
      # - "${SEPAL_DATA_DIR}/app-launcher/service-account-credentials.json:/root/.config/earthengine/credentials"\

      - "${USERS_HOME_PATH:-/home}:/userHomes"
      - "${EE_CREDENTIALS_PATH:-${HOME}/.config/earthengine/credentials}:/root/.config/earthengine/credentials"

    environment:
      EE_CREDENTIALS_PATH
    networks:
      - sepal
    # healthcheck:
    #   test: bash -c "exec 6<> /dev/tcp/localhost/5011"
    #   timeout: 60s
    #   interval: 1s
    #   retries: 60
    restart: always
    # ulimits:
    #   core: 0
    # platform: linux/amd64 # Required for macOS builds

networks:
  sepal:
    external: true